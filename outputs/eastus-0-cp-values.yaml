image:
  registry: r161swx010tsbacrwqwv7ongq6kl7zqo.azurecr.io
  tag: 1.6.1
spec:
  components:
    gitops:
      enabled: true
      reconcileInterval: 600s
    internalCertProvider:
      certManager:
        managed: EXTERNAL
    istio:
      kubeSpec:
        deployment:
          env:
            - name: ROOT_CA_DIR
              value: /vault/secrets
        overlays:
        - apiVersion: install.istio.io/v1alpha1
          kind: IstioOperator
          name: tsb-istiocontrolplane
          patches:
          - path: spec.meshConfig.defaultConfig.holdApplicationUntilProxyStarts
            value: true
          - path: spec.components.pilot.k8s.podAnnotations
            value:
              vault.hashicorp.com/agent-inject: "true"
              vault.hashicorp.com/agent-init-first: "true"
              vault.hashicorp.com/agent-inject-secret-ca-key.pem: "kv/cluster1-istioca"
              vault.hashicorp.com/agent-inject-template-ca-key.pem: |
                      {{- with secret "kv/cluster1-istioca" -}}
                      {{ index .Data "istioca-key.pem" }}
                      {{- end }}
              vault.hashicorp.com/agent-inject-secret-ca-cert.pem: "cluster1-istioca/cert/ca"
              vault.hashicorp.com/agent-inject-template-ca-cert.pem: |
                      {{- with secret "cluster1-istioca/cert/ca" -}}
                      {{ .Data.certificate  }}
                      {{- end }}
              vault.hashicorp.com/agent-inject-secret-root-cert.pem: "pki/cert/ca"
              vault.hashicorp.com/agent-inject-template-root-cert.pem: |
                      {{- with secret "pki/cert/ca" -}}
                      {{ "" | or ( .Data.certificate ) }}
                      {{- end }}
              vault.hashicorp.com/agent-inject-secret-cert-chain.pem: "cluster1-istioca/cert/ca_chain"
              vault.hashicorp.com/agent-inject-template-cert-chain.pem: |
                      {{- with secret "cluster1-istioca/cert/ca_chain" -}}
                      {{ .Data.certificate  }}
                      {{- end }}
              vault.hashicorp.com/role: "cluster1-istiod"
              vault.hashicorp.com/auth-path: "auth/kubernetes"
    oap:
      streamingLogEnabled: true
    xcp:
      centralAuthMode: JWT
      configProtection: {}
  hub: r161swx010tsbacrwqwv7ongq6kl7zqo.azurecr.io
  managementPlane:
    clusterName: aks-r161swx01-eastus-0
    host: r161swx01.azure.sandbox.tetrate.io
    port: 443
    selfSigned: true
  meshObservability:
    settings:
      apiEndpointMetricsEnabled: true
  telemetryStore:
    elastic:
      host: 20.120.121.219
      port: 9200
      protocol: https
      selfSigned: true
      version: 7
